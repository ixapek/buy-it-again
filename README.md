# buy-it-again
Как видно из названия - это простой симулятор покупок. Можно посмотреть и создать товары, 
можно оформить заказ и оплатить его.

##Установка:

* Склонировать или загрузить репозиторий в рабочую папку
* Куда ж без него. На самом деле, нужен только для генерации автозагрузчика, 
т.к. сторониие пакеты тут не используются
```bash
composer install
```

##Конфигурация
####_schema.sql_
Дамп структуры БД

####_Config.php_ 
 * STORAGE_CONFIG - массив с конфигурацией хранилищ. При запуске хранилища убедитесь, 
 что его ключ и параметры присутствуют в массиве
 * STORAGE_DEFAULT - имя хранилища по умолчанию (будет инициализировано, если не передан ключ)
 * CHECK_URL - url, который должен вернуть код успеха при установке стуса оплаты
 
##Структура (src)
 
#### /component
Набор компонентов, необходимых для работы приложения, таких как обработчик HTTP запросов и ответов, 
работа с хранилищем, трейты шаблонов.

##### /http
Обработчик HTTP-запросов и ответов. Не соответствует PSR-7/PSR-18/etc. Выполняет несколько простых задач:
 * Получение, формирование и отправка запроса (_Request.php_)
 * Формирование и рендеринг ответа (_Response.php_)
 
##### /storage
Работа с хранилищем данных. По умолчанию реализована работа с хранилищем через PDO, но можно добавить любой 
драйвер, удовлетворяющий интерфейсу. 
 * _IStorage.php_ - интерфейс хранилища
 * _Storage.php_ - Мультитон для работы с хранилищами. Для обращения к недефолтовому хранилищу используйте 
 Storage::init(*название хранилища из конфига*)
 * _PDOStorage.php_ - Хранилище на базе драйвера PDO
 
#### /controller
Набор контроллеров для обработки HTTP REST запросов. Все контроллеры реализуют базовый интерфейс _IController_
и должны обратывать методы, указанные в getAllowed
 
#### /entity
Представления моделей БД. Реализуют _IEntity_. Получение моделей происходит через репозитории
 
#### /repository
Набор синглтонов для генерации _entity_. Классы реализуют базовый интерфейс _IRepository_ и являются коллекциями
моделей. Данные объекты реализуют только получение, функции создания и редактирования реализуют сервисы
 
#### /service
Сервисы актуализируют состояние данных в хранилище на основании состояния представлений в программе. 
В задачи сервиса входит принятие решения о необходимом действии: редактирование или создания, а также выполнение этого 
действия.
 
## Поддерживаемые запросы
 * Получить все существующие товары
 ```
 GET /ProductCollection
 ```
 * Сгенерировать 20 случайных товаров
  ```
  POST /ProductCollection
  ```
 * Разместить заказ с 4 заказами с ID 1,4,22,2
  ```
  POST /Order?products[]=1&products[]=4&products[]=22&products[]=2
  ```
 * Оплатить заказ с ID 5 суммой 194414.88. Сумма должна совпадать с суммой 
 стоимостей товаров в заказе
  ```
  PUT /Order?id=5&pay=194414.88
  ```
 